# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Based is a browser-based database UI for PostgreSQL, built with Next.js 15 and Bun. It provides a clean interface for viewing and managing database tables, schemas, and data.

## Essential Commands

### Development
```bash
bun dev          # Start development server with Turbopack
bun build        # Create production build
bun start        # Run production server
```

### Code Quality
```bash
bun format       # Format code with Biome
bun lint         # Lint code with Biome
bun check        # Run both format and lint with auto-fix
```

### Database Setup
```bash
bun docker       # Start PostgreSQL with Docker Compose
bun setupDb      # Initialize database schema
bun seedDb       # Seed database with sample data
```

## Architecture

### Tech Stack
- **Runtime**: Bun (not Node.js)
- **Framework**: Next.js 15.3.1 with React 19
- **Database**: PostgreSQL 17 via Bun's SQL library
- **Styling**: Tailwind CSS v4 + shadcn/ui components
- **Code Quality**: Biome (replaces ESLint/Prettier)

### Project Structure
- `src/app/` - Next.js App Router pages and layouts
- `src/components/` - React components (UI components in `ui/` are auto-generated by shadcn)
- `src/lib/` - Core business logic:
  - `db.ts` - Database connection singleton and all SQL operations
  - `actions.ts` - Next.js server actions wrapping database functions
- `src/hooks/` - Custom React hooks
- `scripts/` - Database setup and seeding scripts

### Key Patterns

1. **Database Operations**: All database queries are in `src/lib/db.ts` using direct SQL (no ORM)
2. **Server Actions**: Data mutations use Next.js server actions pattern in `src/lib/actions.ts`
3. **Path Aliases**: Use `@/` for imports from `src/` directory
4. **Components**: Follow shadcn/ui conventions; don't modify files in `src/components/ui/`

### Environment Variables
Required for database connection:
- `POSTGRES_USER`
- `POSTGRES_PASSWORD`
- `POSTGRES_DB`
- `POSTGRES_PORT`

## CI/CD

### Docker Image Publishing
The repository includes a GitHub Action that automatically builds and publishes Docker images to GitHub Container Registry (ghcr.io):
- Triggers on version tags (e.g., `v1.0.0`, `v2.1.3`) and manual dispatch
- Uses Depot for fast, multi-platform builds (linux/amd64 and linux/arm64)
- Published as a public image at `ghcr.io/[owner]/based`
- Image tags match the git tag version (e.g., git tag `v1.2.3` creates Docker tags `1.2.3`, `1.2`, `1`, and `latest`)

## Important Notes

- Always use `bun` instead of `npm` or `yarn`
- Run `bun check` before committing to ensure code quality
- The app runs on port 3001 when using Docker
- Database connection uses singleton pattern to prevent connection leaks
- All server-side database operations must go through server actions
